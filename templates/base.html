<!DOCTYPE html>
<html lang="en">
<head>
    <script nonce="{{ nonce }}">
        try {
            const pref = localStorage.getItem('theme');
            const dark = pref ? (pref === 'dark') :
            window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.classList.toggle('dark', dark);
        } catch (_) {}
    </script>
    <meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/x-icon" href="/static/img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com" nonce="{{ nonce }}"></script>
    <script nonce="{{ nonce }}">
        tailwind.config = {
            darkMode: 'class',
            corePlugins: { preflight: false }
        };
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" nonce="{{ nonce }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <meta name="color-scheme" content="light dark">
    <script src="https://code.highcharts.com/highcharts.js" nonce="{{ nonce }}"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" nonce="{{ nonce }}"></script>
    <!-- Quill.js WYSIWYG Editor -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js" nonce="{{ nonce }}"></script>
    <title>{% block title %}newsletterr{% endblock %}</title>
</head>
<body>
    <div id="spinner" class="spinner spinner-hidden">
        <img src="/static/img/load.gif" alt="Loading..." />
        <p id="loading-text"></p>
    </div>
    <nav class="navbar">
        <ul id="navLinks">
            <li><a href="{{ url_for('index') }}" class="hover:underline">newsletterr</a></li>
            <li><a href="{{ url_for('email_history') }}" class="hover:underline">email history</a></li>
            <li><a href="{{ url_for('scheduling') }}" class="hover:underline">scheduling</a></li>
            <li><a href="{{ url_for('settings') }}" class="hover:underline">settings</a></li>
            <li><a href="{{ url_for('about') }}" class="hover:underline">about</a></li>
            <li class="cache-badge-container">
                {% set cache_status = get_cache_status() %}
                <span class="cache-badge-base {{ cache_status.class }}" 
                      title="{{ cache_status.status }}\nPresent: {{ cache_status.present|join(', ') if cache_status.present else 'none' }}\nMissing: {{ cache_status.missing|join(', ') if cache_status.missing else 'none' }}">
                    <strong>Cache:</strong>
                    {% if cache_status.has_data %}
                        {{ cache_status.age_display }}
                    {% else %}
                        none
                    {% endif %}
                </span>
            </li>
        </ul>
        {% if update_info.is_newer %}
            <div class="update-notification">
                A new version {{ update_info.latest }} is available.
                <a href="{{ update_info.release_url }}" target="_blank" rel="noopener">See release notes</a>
            </div>
        {% endif %}
        <div class="theme-toggle-container">
            <button id="theme-toggle" type="button" role="switch" aria-checked="false" aria-label="Toggle dark mode" class="relative inline-flex h-8 w-16 items-center rounded-full bg-gray-200 dark:bg-gray-700 transition-colors focus:outline-none transform -translate-x-2 translate-y-2.5">
                <span class="pointer-events-none absolute inset-0 z-20 flex items-center justify-between px-1">
                    <svg class="h-5 w-5 text-amber-400 transition-opacity duration-100 ease-in-out dark:!opacity-0 transform translate-x-1 translate-y-0.5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5">
                            <path d="M8 1.11133V2.00022" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M12.8711 3.12891L12.2427 3.75735" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M14.8889 8H14" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M12.8711 12.8711L12.2427 12.2427" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M8 14.8889V14" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M3.12891 12.8711L3.75735 12.2427" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M1.11133 8H2.00022" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M3.12891 3.12891L3.75735 3.75735" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                            <path d="M8.00043 11.7782C10.0868 11.7782 11.7782 10.0868 11.7782 8.00043C11.7782 5.91402 10.0868 4.22266 8.00043 4.22266C5.91402 4.22266 4.22266 5.91402 4.22266 8.00043C4.22266 10.0868 5.91402 11.7782 8.00043 11.7782Z" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
                        </g>
                    </svg>
                    <svg class="h-5 w-5 text-blue-100 transition-opacity duration-100 ease-in-out opacity-0 dark:!opacity-100 transform -translate-x-1.5 translate-y-0" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                        <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"/>
                    </svg>
                </span>
                <span class="absolute z-10 inline-block h-6 w-6 rounded-full bg-white shadow transform transition will-change-transform translate-x-1 dark:translate-x-8"></span>
            </button>
            <img src="/static/img/Asset_94x.png" alt="Logo" class="logo" />
        </div>
    </nav>
    {% block content %}{% endblock %}
    <script nonce="{{ nonce }}">
        function showSpinner(passedText) {
            document.getElementById('spinner').style.display = 'flex';
            document.getElementById('loading-text').innerText = passedText;
        }

        function hideSpinner() {
            document.getElementById('spinner').style.display = 'none';
        }
    </script>
    <script nonce="{{ nonce }}">
        (function initTheme() {
            const saved = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.classList.toggle('dark', saved ? saved === 'dark' : prefersDark);
        })();

        const btn = document.getElementById('theme-toggle');
        function syncAria() {
            btn?.setAttribute('aria-checked', document.documentElement.classList.contains('dark'));
        }
        syncAria();

        btn?.addEventListener('click', () => {
            const root = document.documentElement;
            const isDark = root.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            syncAria();
            updatePreview();
        });
    </script>
</body>
<footer class="site-foot">
    <p class="left-foot">
        Newsletterr Â© 2025. <a target="_blank" href="https://discord.gg/7Skcsqs4uT">Join the discussion on Discord!</a>
    </p>
    <p class="middle-foot">
        <a target="_blank" href="https://ko-fi.com/newsletterr">Tip the devs</a>
    </p>
    <p class="right-foot">
        {{ version }}
        <a target="_blank" href="https://github.com/jma1ice/newsletterr">GitHub</a>
    </p>
</footer>
</html>
